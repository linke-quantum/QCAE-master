# This code is part of LINKEQ.
#
# (C) Copyright LINKE 2023.
#
# This code is licensed under the Apache License, Version 2.0. You may
# obtain a copy of this license in the LICENSE.txt file in the root directory
# of this source tree or at http://www.apache.org/licenses/LICENSE-2.0.
#
# Any modifications or derivative works of this code must retain this
# copyright notice, and modified files need to carry a notice indicating
# that they have been altered from the originals.
#
# -*- coding: utf-8 -*-
# @Time     : 2024/1/30 15:27
# @Author   : deviludier @ LINKE
# @File     : landscape.py
# @Software : PyCharm
import numpy as np
from qiskit.circuit.library import RealAmplitudes
from src.QCAE import QCAE
import matplotlib.pyplot as plt
import os

class Landscape(QCAE):
    def run(self, target_op_list: list, max_it=100, noValidation=True):
        self.target_op_list = target_op_list

        execute_qc = self.QCAE_circuit(target_op=target_op_list[0])

        params = np.random.random(len(execute_qc.parameters))
        print(self.cost_func(params=params))

        # 确定x和y的取值范围
        x_min, x_max = -np.pi, np.pi
        y_min, y_max = -np.pi, np.pi

        # 在取值范围内均匀分布生成网格点
        x_values = np.linspace(x_min, x_max, 10)
        y_values = np.linspace(y_min, y_max, 10)
        X, Y = np.meshgrid(x_values, y_values)

        # 计算每个网格点对应的损失值
        Z = np.zeros((len(y_values), len(x_values)))
        for i in range(len(y_values)):
            for j in range(len(x_values)):
                params[0] = x_values[j]
                params[1] = y_values[i]
                Z[i][j] = self.cost_func(params)

        # 使用三维图像展示
        fig = plt.figure(figsize=(7, 6))
        ax = fig.add_subplot(111, projection='3d')
        ax.plot_surface(X, Y, Z, cmap='coolwarm')
        ax.set_xlabel('x1', fontsize=14, labelpad=18)
        ax.set_ylabel('x2', fontsize=14, labelpad=18)
        ax.set_zlabel('Loss', fontsize=14, labelpad=18)
        ax.tick_params(axis='x', which='major', labelsize=14, rotation=20)
        ax.tick_params(axis='y', which='major', labelsize=14)
        ax.tick_params(axis='z', which='major', labelsize=14)

        path = '../results/figs/landscape/'
        if not os.path.exists(path):
            os.makedirs(path)
        fig_path = path + str(self.num_latent) + "-" + str(self.num_trash) + 'landscape.pdf'
        plt.savefig(fig_path)
        plt.show()

if __name__ == "__main__":
    print("begin test:")
    list = []
    a = 'a'
    for num_trash in [1, 2]:
        for num_latent in range(2,5):
            num_qubit = num_latent + num_trash
            # qcae = Landscape(num_latent=num_latent, num_trash=num_trash)
            # pqc = RealAmplitudes(num_qubits=num_qubit)
            # target_op_list = []
            # mu, sigma = 0, 0.1
            # params_list = []
            # # params_list = [[0.14197426826820497, -0.08643398131774715, -0.02205151381430555, -0.03966011320578985, -0.08875066764695722, 0.0030778571199189335, 0.15992936181914216, -0.08594785797697617, -0.13747426804621732, -0.010234325332646687, 0.04045056530350146, -0.06363325695076237, -0.018400603698842135, -0.15973852916511888, -0.07839965066261585, -0.07030682479384741, 0.01901558206048353, -0.15741244436607996, -0.06233621107849324, -0.029211000082070823, 0.05310024445149591, -0.1818444686343666, 0.0739199058799087, 0.00359220499086913, -0.020364755639099584, 0.18000311871543737, -0.1618782508643712, -0.09877298135526934, -0.03339441837627823, 0.01135104282161917, -0.09521668702324022, -0.2051522786693568, -0.03730412343797269, 0.11684930238245124, 0.06032592147887975, -0.08637387633194514, 7.863212827351952e-05, 0.04028232067977087, -0.02435663785354176, 0.09784135089920643, 0.02519680093433714, -0.15407056389884574, 0.10325596789775884, -0.2573020126660751], [-0.03697258435453581, 0.028631352360312542, 0.022185121291923238, 0.008122169210217202, 0.06172012710990752, -0.14411831832932184, -0.08847152864300163, 0.000547289189151296, 0.04694960198209386, -0.10030823709593568, 0.09648828956558571, 0.094085751800042, 0.137189429939495, 0.034539081688296246, 0.05524058779537403, -0.1720918427988741, -0.10883149847987164, 0.05073458816834036, 0.09645566417067505, -0.18212763245839703, 0.004363592431082803, -0.152405001171426, -0.13384886641652005, -0.10474520721920717, -0.009876209132846793, 0.06943318270521137, 0.13371937483867244, -0.15632474364363486, 0.11036073139218001, 0.10161547640602298, 0.1951472340989836, -0.22893221991113322, -0.04970929578479526, -0.16183701944519724, -0.05189678395184499, 0.061648059484475104, 0.04933579528328062, -0.1222090249497314, 0.23205843233684753, 0.06557887527204859, -0.010300276213574693, -0.10886630955044121, 0.024417369714392127, 0.013472142918411617], [-0.01082332872136649, -0.13841514175508288, 0.013315037531817503, 0.11686669514009147, -0.16984126196591426, 0.140495306421661, 0.0706088351311175, -0.13575118597595542, 0.06467774373879819, -0.11309563930447819, 0.11156827658904747, -0.08896636972990883, 0.019168740728870842, 0.12210311803716967, -0.17339312982376157, -0.18124912451206457, 0.06946746425374015, 0.0567335831484686, -0.11424689375321542, -0.022638419471616496, 0.11995033126631467, 0.13504038547819677, 0.152123834921742, 0.10985783939249792, -0.1091686589173331, 0.027780154646688794, -0.16777277755468967, 0.012556666614364685, -0.142006021893344, 0.03959664422236249, -0.08475054129828727, 0.08111288958491819, -0.03408863223080235, 0.16920484693808788, 0.11390666703790396, -0.14086928965393447, 0.0328869191486273, 0.01046163895173024, 0.05695127720669853, 0.04610721861265842, -0.01628332029682354, -0.056825911110914076, -0.004114883968922446, -0.045384363300059946], [0.16635117516883835, -0.10210988876927828, 0.018885240393425935, -0.03464129894122191, 0.1203931854051969, 0.01265694130316141, -0.010344259552479236, 0.07464661600461969, -0.03278558630612452, 0.03262199004387193, -0.009717863109128033, -0.1285693388453404, -0.03581910514254365, 0.10284555559919238, -0.029217147250837495, 0.14456408597049417, 0.08153492557446768, 0.02976717342639087, 0.24791226358794127, 0.014115804558226445, -0.03442589037035928, -0.16480264927412244, 0.017216461331798903, -0.044306074407314947, -0.011098787505552987, 0.10258312839876985, -0.09177381527589341, -0.2181747523974419, 0.006102311182213681, 0.010746423044165863, -0.0776573593337268, -0.16868482737625543, 0.10653973110476928, 0.21970847254584594, 0.06772553843644634, -0.16295319318957313, 0.10145474644079702, 0.12314208574987129, -0.021585334519452812, 0.10506619149511771, 0.11241513345417001, -0.09515785502374725, -0.12715679546278874, -0.04734125348695077], [0.015512999734826467, 0.007043903107495454, -0.0992849499707449, 0.07421819462622661, 0.01031600568449669, 0.08260983209941918, 0.01591516571839222, -0.025136078918609157, 0.08142007734251115, -0.005016702968117594, -0.06990211981070502, -0.09344812306425547, 0.034226217249331954, -0.11098839239494163, 0.06123837868793715, -0.11024023472259599, -0.07536690117279525, -0.044903247326311214, -0.02845897823587484, 0.059542592824399936, 0.0048836601106135415, -0.08780090825821091, 0.013187311827309213, -0.052097635725296326, -0.08444607985976607, 0.06841380634400916, 0.11666873593165475, 0.10614480159753636, 0.09095179127088189, -0.005344481396003298, 0.01147029037298421, -0.11369372791226207, -0.10825851917623308, -0.030124664375197174, 0.03708942909142624, 0.19771785601557534, -0.0498553018858705, 0.0810993377004822, -0.06426002420430597, -0.06880217108514879, -0.0747696504019971, 0.004911782568746486, 0.02601301583457787, -0.11337238684704826], [-0.052696231595922294, 0.1251085356071654, 0.02622163469686267, 0.11683195615480989, -0.02705405756429309, -0.19705257580749036, 0.05334351461177578, -0.06350901773972611, 0.025327695925273758, 0.03779015566843863, 0.04972074103154678, 0.13099078788123514, -0.021978302649627114, -0.02613120470521111, 0.05649689961473575, -0.2204811195841906, 0.017181338702295382, 0.041193852091029104, -0.0023285268411118785, 0.01478345577349077, -0.034180299190519806, -0.0545384946806993, -0.12248390603484927, 0.19983943115488448, 0.1029180417680588, -0.03051410794890186, -0.045623186915602174, 0.08734872607312212, -0.1637729734669271, 0.0001376855160744948, 0.09534704662797631, 0.2491480062241409, -0.17559046680940393, -0.06331947748142014, -0.0025347464585815447, -0.2844759576196799, -0.0924198403499429, 0.021695202430900565, -0.029829807900389766, -0.053587710309359875, 0.08616415113895749, 0.08700578664130976, -0.07673543333060419, -0.2052205864499083], [-0.06234931911314744, -0.09945305326328487, -0.19201257239658534, 0.17117038936847712, 0.027186251915726996, 0.028780478289461914, 0.11847638592642934, -0.012369523839346743, 0.03887526460553354, -0.02233042541792518, 0.09371859656075951, -0.10652627900931214, 0.04998832065530638, 0.14119470951756521, -0.012173953922298942, 0.14283535474857753, -0.16120776672763104, 0.06552551377710476, -0.10514300106886446, -0.03921992989597499, -0.08085719482864151, -0.04877627184836313, 0.15146948058989604, -0.17466876541778173, -0.041832138327586164, 0.048042314746679825, 0.047653372602133745, -0.08055858764883495, 0.09997964065857308, 0.015113311733392313, 0.16250383054946216, 0.061985198445040815, -0.015238363133442548, 0.09636664405281244, -0.018204316944223243, -0.09618298425144306, 0.103291867376547, 0.04614057818495888, 0.05562274289995607, -0.019263788211368364, -0.10095186892271124, -0.02376001946312018, -0.13122952483720596, 0.0032015797592672398], [0.0546810407383258, -0.023427231247092957, 0.2094572655129642, 0.0677828281753228, 0.1013362246435706, -0.19574629137026262, 0.07436684765372985, 0.20981876506115227, -0.002823871989563241, 0.000534259962407443, 0.19193318707168452, -0.1502656729498941, 0.03383900373402487, 0.1565474596060115, 0.09070490526672322, 0.08751773867806843, -0.17131781748086355, 0.22772697960659471, -0.0072624589889136, 0.04806071662037251, -0.024926551325642744, 0.030267258811818788, -0.004974963413140195, -0.05406620752416418, 0.05133416199006682, 0.10583303071807795, 0.055025265954268945, -0.0562979458449091, -0.14955478315583684, 0.03481478643297614, 0.08303374567986892, -0.015283693289365081, -0.11896230309747602, -0.0023200860705867455, -0.04231202092103478, -0.18027045247790693, 0.07470970490846336, -0.075570128216049, 0.02616742523838746, 0.0047048560111368435, -0.07551025502462327, 0.01513014176228112, -0.17857476085175933, 0.20612048820035533], [-0.02103803222022499, 0.2747350754543641, -0.14438241716190234, -0.0764704901307058, 0.06490727926955571, -0.11188157164720614, -0.12717570296725375, -0.09275787294896956, -0.021293115977762716, 0.035216084999281104, -0.08260342607696315, -0.2674470394676695, 0.013752629847664106, -0.11387279947619389, -0.03379884265797813, -0.03862790583441937, -0.028900537626947883, -0.1366666967330862, 0.1427415611449925, -0.007454316665873187, 0.1500877015264513, -0.0009624372802330944, -0.10181492267223238, 0.04685528126763409, 0.03671995762563315, 0.04555053121614624, 0.08835234793700275, 0.03566168611932026, 0.0063292906486530605, -0.26493628624790716, 0.06397045891216245, 0.001199667410562992, -0.06753779701288502, -0.04413301728762443, -0.2103872771663328, -0.11408828367553805, -0.17941377924345278, -0.028292443120762956, -0.0066607369434956015, 0.022741693978643025, -0.14327468998699788, 0.1304007640300263, 0.13323005645875427, -0.052202105913803115], [0.08938736337202413, -0.1499756905133395, -0.050165595401666464, 0.07477112518503175, 0.131064303861667, 0.0682551010823128, -0.07168464189987203, -0.08435388011880762, 0.12736108353174003, -0.11748276735763777, 0.06948011927445924, 0.09044841578531176, -0.08535058480601804, -0.0010203915078477977, -0.0553146953554723, 0.014203054246342882, -0.21610396992791717, -0.13224199604198858, -0.15294932641551656, 0.13661667206784658, -0.04906317080627577, 0.03092888842448844, 0.013542615357764555, 0.13010822473470102, -0.045296591499372346, 0.06376990910225033, 0.01891070941524371, 0.061219710254035886, 0.11582154529782723, -0.05542335134961251, -0.15125208467005946, 0.036842690896478396, -0.11317980377312209, -0.039671502370887235, -0.028675810056225527, 0.06255399286836164, -0.04253077054594347, -0.060055464760981114, 0.1635813353059455, -0.09565025276607994, -0.2193014062343439, 0.030772046519993636, -0.16708578297716653, 0.009809912187311847]]
            # for i in range(10):
            #     params = np.random.normal(mu, sigma, len(pqc.parameters))
            #     # print(params)
            #     params_list.append(params.tolist())
            #     params = params_list[i]
            #     target_op = pqc.assign_parameters(params)
            #     target_op_list.append(target_op)
            #     # print(target_op)
            # # qc = QuantumCircuit(num_qubit)
            # # qc.append(target_op, [0, 1, 2])
            # # path = "../circuits/OLSQ/"
            # # file_name = ['4gt13_92.qasm', '4mod5-v1_22.qasm']
            # # for file in file_name[:1]:
            # #     pathr = path + file
            # #     qc = QuantumCircuit.from_qasm_file(pathr)
            # #     target_op_list.append(qc)
            # qcae.run(target_op_list)
            print('(' + a + ") (" + str(num_qubit) + ',' + str(num_latent) + ').')
            a = chr(ord(a)+1)
